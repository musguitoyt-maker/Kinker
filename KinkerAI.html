<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kinker AI | Elite</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --p: #0f172a; --a: #3b82f6; --bg: #f8f9fc; --c: #ffffff; --border: #e2e8f0; --sub: #64748b; }
        * { box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; padding: 0; }
        body { background: var(--bg); height: 100dvh; display: flex; overflow: hidden; color: var(--p); }
        
        /* Sidebar Blanco y Responsivo */
        #sidebar { 
            width: 280px; background: var(--c); border-right: 1px solid var(--border); 
            display: flex; flex-direction: column; transition: transform 0.3s ease;
            position: fixed; height: 100%; z-index: 1000; left: 0;
        }
        .side-h { padding: 1.5rem; font-weight: 800; font-size: 1.1rem; border-bottom: 1px solid var(--border); color: var(--p); }
        .new-chat { 
            margin: 15px; padding: 12px; background: var(--p); color: white; 
            border-radius: 10px; cursor: pointer; text-align: center; font-size: 0.85rem; font-weight: 700; transition: 0.2s;
        }
        .new-chat:hover { opacity: 0.9; }
        .chat-list { flex: 1; overflow-y: auto; padding: 10px; }
        .chat-item { 
            padding: 12px; border-radius: 10px; margin-bottom: 5px; font-size: 0.85rem; 
            cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; 
            color: var(--sub); transition: 0.2s; border: 1px solid transparent;
        }
        .chat-item:hover { background: #f1f5f9; color: var(--p); }
        .active-chat { background: #eff6ff; color: var(--a); border-color: #bfdbfe; font-weight: 600; }

        /* Contenedor Principal */
        .app { flex: 1; display: flex; flex-direction: column; background: var(--c); margin-left: 280px; transition: margin 0.3s ease; }
        header { padding: 1rem 1.5rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .logo-box { display: flex; align-items: center; gap: 12px; }
        .menu-toggle { display: none; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--p); }
        .logo { font-weight: 800; font-size: 1.2rem; color: var(--p); display: flex; align-items: center; gap: 8px; }
        .logo::before { content: ''; width: 8px; height: 24px; background: var(--a); border-radius: 4px; }

        #chat { flex: 1; padding: 1.5rem; overflow-y: auto; display: flex; flex-direction: column; gap: 1rem; }
        .m { max-width: 85%; padding: 0.8rem 1.2rem; border-radius: 15px; font-size: 0.95rem; line-height: 1.4; animation: fadeIn 0.2s ease; position: relative; }
        .ai { align-self: flex-start; background: #f1f5f9; border-bottom-left-radius: 2px; }
        .user { align-self: flex-end; background: var(--p); color: #fff; border-bottom-right-radius: 2px; }
        
        .gen-img { width: 100%; border-radius: 12px; margin-top: 10px; display: block; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .btn-v { margin-top: 8px; background: #fff; border: 1px solid var(--border); padding: 6px 12px; border-radius: 8px; cursor: pointer; font-size: 0.7rem; font-weight: 700; color: var(--sub); }

        .footer { padding: 1rem; border-top: 1px solid var(--border); }
        .in-g { display: flex; gap: 8px; align-items: center; background: #f8fafc; padding: 5px; border-radius: 12px; border: 1px solid var(--border); }
        input { flex: 1; border: none; background: transparent; padding: 12px; outline: none; font-size: 1rem; color: var(--p); }
        .btn-s { background: var(--p); color: #fff; border: none; width: 44px; height: 44px; border-radius: 10px; cursor: pointer; font-size: 1.2rem; }
        #status { font-size: 0.75rem; color: var(--a); font-weight: 700; margin-bottom: 4px; height: 1rem; padding-left: 5px; }

        /* AdaptaciÃ³n para mÃ³viles */
        @media (max-width: 900px) {
            #sidebar { transform: translateX(-100%); }
            .app { margin-left: 0; }
            .menu-toggle { display: block; }
            .sidebar-open #sidebar { transform: translateX(0); }
            .sidebar-open .overlay { display: block; }
        }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 900; }
    </style>
</head>
<body id="body">

<div class="overlay" onclick="toggleMenu()"></div>

<aside id="sidebar">
    <div class="side-h">KINKER HISTORIAL</div>
    <div class="new-chat" onclick="createNewChat()">+ Nueva ConversaciÃ³n</div>
    <div class="chat-list" id="chatList"></div>
</aside>

<div class="app">
    <header>
        <div class="logo-box">
            <button class="menu-toggle" onclick="toggleMenu()">â˜°</button>
            <div class="logo">KINKER AI</div>
        </div>
        <button onclick="deleteHistory()" style="border:none; background:none; color: #ef4444; font-size: 0.75rem; font-weight: 700; cursor: pointer;">Limpiar Historial</button>
    </header>
    
    <div id="chat"></div>

    <div class="footer">
        <div id="status"></div>
        <div class="in-g">
            <input type="text" id="uIn" placeholder="Pregunta a Kinker AI..." autocomplete="off">
            <button class="btn-s" onclick="send()">âž”</button>
        </div>
    </div>
</div>

<script>
    const KEY = "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";
    const URL = "https://api.groq.com/openai/v1/chat/completions";
    
    let currentChatId = Date.now();
    let allChats = JSON.parse(localStorage.getItem('kinker_chats')) || {};

    function toggleMenu() {
        document.getElementById('body').classList.toggle('sidebar-open');
    }

    function talk(btn) {
        window.speechSynthesis.cancel();
        const text = btn.parentElement.querySelector('.txt-c').innerText;
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'es-ES';
        window.speechSynthesis.speak(u);
    }

    function add(t, s, save = true) {
        const c = document.getElementById('chat');
        const d = document.createElement('div');
        d.className = `m ${s}`;
        
        let cleanText = t.split('[GEN_IMG:')[0].trim();
        let html = `<div class="txt-c">${cleanText}</div>`;
        
        if (s === 'ai' && t.includes('[GEN_IMG:')) {
            const prompt = t.split('[GEN_IMG:')[1].split(']')[0];
            const imgUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?nologo=true&seed=${Math.floor(Math.random()*1000000)}`;
            html += `<img src="${imgUrl}" class="gen-img">`;
        }

        if (s === 'ai') html += `<button class="btn-v" onclick="talk(this)">ðŸ”Š Escuchar</button>`;
        
        d.innerHTML = html;
        c.appendChild(d);
        c.scrollTop = c.scrollHeight;

        if(save) saveCurrentChat();
    }

    async function send() {
        const i = document.getElementById('uIn');
        const val = i.value.trim();
        if (!val) return;

        add(val, 'user');
        document.getElementById('status').innerText = "KINKER AI PENSANDO...";
        i.value = "";
        if(window.innerWidth < 900) document.getElementById('body').classList.remove('sidebar-open');

        try {
            const r = await fetch(URL, {
                method: "POST",
                headers: { "Content-Type": "application/json", "Authorization": `Bearer ${KEY}` },
                body: JSON.stringify({ 
                    model: "llama-3.3-70b-versatile", 
                    messages: [{role: "system", content: "Eres Kinker AI creada por Kinker. Si piden imagen usa [GEN_IMG: prompt en inglÃ©s]."}, ...getHistoryForApi(), {role: "user", content: val}],
                    temperature: 0.7
                })
            });
            const d = await r.json();
            const res = d.choices[0].message.content;
            document.getElementById('status').innerText = "";
            add(res, 'ai');
            updateSidebar();
        } catch (e) {
            document.getElementById('status').innerText = "";
            add("Error de conexiÃ³n.", "ai");
        }
    }

    function saveCurrentChat() {
        const messages = [];
        document.querySelectorAll('.m').forEach(div => {
            messages.push({
                type: div.classList.contains('user') ? 'user' : 'ai',
                content: div.innerHTML
            });
        });
        const firstMsg = messages.find(m => m.type === 'user')?.content.replace(/<[^>]*>/g, '').substring(0, 30) || "Nueva charla";
        allChats[currentChatId] = { title: firstMsg, data: messages };
        localStorage.setItem('kinker_chats', JSON.stringify(allChats));
    }

    function updateSidebar() {
        const list = document.getElementById('chatList');
        list.innerHTML = "";
        Object.keys(allChats).reverse().forEach(id => {
            const item = document.createElement('div');
            item.className = `chat-item ${id == currentChatId ? 'active-chat' : ''}`;
            item.innerText = allChats[id].title;
            item.onclick = () => { loadChat(id); if(window.innerWidth < 900) toggleMenu(); };
            list.appendChild(item);
        });
    }

    function loadChat(id) {
        currentChatId = id;
        document.getElementById('chat').innerHTML = "";
        allChats[id].data.forEach(m => {
            const d = document.createElement('div');
            d.className = `m ${m.type}`;
            d.innerHTML = m.content;
            document.getElementById('chat').appendChild(d);
        });
        updateSidebar();
    }

    function createNewChat() {
        currentChatId = Date.now();
        document.getElementById('chat').innerHTML = "";
        add("Hola, soy Kinker AI desarrollada por Kinker. Â¿En quÃ© puedo ayudarte?", "ai", false);
        updateSidebar();
        if(window.innerWidth < 900) toggleMenu();
    }

    function getHistoryForApi() {
        if(!allChats[currentChatId]) return [];
        return allChats[currentChatId].data.map(m => ({
            role: m.type === 'user' ? 'user' : 'assistant',
            content: m.content.replace(/<[^>]*>/g, '')
        })).slice(-6);
    }

    function deleteHistory() {
        if(confirm("Â¿Eliminar todas las conversaciones?")) {
            localStorage.removeItem('kinker_chats');
            allChats = {};
            createNewChat();
        }
    }

    document.getElementById('uIn').addEventListener('keypress', (e) => { if(e.key === 'Enter') send(); });
    window.onload = () => {
        updateSidebar();
        if(Object.keys(allChats).length > 0) loadChat(Object.keys(allChats).sort().reverse()[0]);
        else createNewChat();
    };
</script>
</body>
</html>
